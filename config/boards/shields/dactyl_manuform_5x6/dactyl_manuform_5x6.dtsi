#include <dt-bindings/zmk/matrix_transform.h>
#include <physical_layouts.dtsi>

/ {
    chosen {
        zmk,kscan = &kscan0;
        zmk,physical-layout = &physical_layout;
    };

    default_transform: keymap_transform_0 {
        compatible = "zmk,matrix-transform";
        columns = <12>;
        rows = <6>;
// | MX1  | MX2  | MX3  | MX4  | MX5  | MX6  |                 | MX7  | MX8  | MX9  | MX10 | MX11 | MX12 |
// | MX13 | MX14 | MX15 | MX16 | MX17 | MX18 |                 | MX19 | MX20 | MX21 | MX22 | MX23 | MX24 |
// | MX25 | MX26 | MX27 | MX28 | MX29 | MX30 |                 | MX31 | MX32 | MX33 | MX34 | MX35 | MX36 |
// | MX37 | MX38 | MX39 | MX40 | MX41 | MX42 |                 | MX43 | MX44 | MX45 | MX46 | MX47 | MX48 |
//               | MX49 | MX50 |                                             | MX51 | MX52 |
//                             | MX53 | MX54 |                 | MX55 | MX56 |
//                                    | MX57 | MX58 |   | MX59 | MX60 |
//                                    | MX61 | MX62 |   | MX63 | MX64 |
        map = <
RC(0,0) RC(0,1) RC(0,2) RC(0,3) RC(0,4) RC(0,5)                   RC(0,11) RC(0,10) RC(0,9) RC(0,8) RC(0,7) RC(0,6)
RC(1,0) RC(1,1) RC(1,2) RC(1,3) RC(1,4) RC(1,5)                   RC(1,11) RC(1,10) RC(1,9) RC(1,8) RC(1,7) RC(1,6)
RC(2,0) RC(2,1) RC(2,2) RC(2,3) RC(2,4) RC(2,5)                   RC(2,11) RC(2,10) RC(2,9) RC(2,8) RC(2,7) RC(2,6)
RC(3,0) RC(3,1) RC(3,2) RC(3,3) RC(3,4) RC(3,5)                   RC(3,11) RC(3,10) RC(3,9) RC(3,8) RC(3,7) RC(3,6)
                RC(4,2) RC(4,3)                                                     RC(4,9) RC(4,8)
                                RC(4,4) RC(4,5)                   RC(4,11) RC(4,10)
                                        RC(5,4) RC(5,5)  RC(5,11) RC(5,10)
                                        RC(5,2) RC(5,3)  RC(5,9)  RC(5,8)
        >;
    };

    physical_layout: physical_layout_0 {
    compatible = "zmk,physical-layout";
    display-name = "Custom Layout";
    transform = <&default_transform>;

    keys  //                 w   h  x    y
        // Левая половина - основные ряды
        = < &key_physical_attrs 100 100 0    0   > // MX1  (row0 col0)
        , < &key_physical_attrs 100 100 100  0   > // MX2  (row0 col1)
        , < &key_physical_attrs 100 100 200  0   > // MX3  (row0 col2)
        , < &key_physical_attrs 100 100 300  0   > // MX4  (row0 col3)
        , < &key_physical_attrs 100 100 400  0   > // MX5  (row0 col4)
        , < &key_physical_attrs 100 100 500  0   > // MX6  (row0 col5)

        // Правая половина - основные ряды (зеркально)
        , < &key_physical_attrs 100 100 800  0   > // MX7  (row0 col11)
        , < &key_physical_attrs 100 100 900  0   > // MX8  (row0 col10)
        , < &key_physical_attrs 100 100 1000 0   > // MX9  (row0 col9)
        , < &key_physical_attrs 100 100 1100 0   > // MX10 (row0 col8)
        , < &key_physical_attrs 100 100 1200 0   > // MX11 (row0 col7)
        , < &key_physical_attrs 100 100 1300 0   > // MX12 (row0 col6)

        // Второй ряд левая половина
        , < &key_physical_attrs 100 100 0    100 > // MX13 (row1 col0)
        , < &key_physical_attrs 100 100 100  100 > // MX14 (row1 col1)
        , < &key_physical_attrs 100 100 200  100 > // MX15 (row1 col2)
        , < &key_physical_attrs 100 100 300  100 > // MX16 (row1 col3)
        , < &key_physical_attrs 100 100 400  100 > // MX17 (row1 col4)
        , < &key_physical_attrs 100 100 500  100 > // MX18 (row1 col5)

        // Второй ряд правая половина
        , < &key_physical_attrs 100 100 800  100 > // MX19 (row1 col11)
        , < &key_physical_attrs 100 100 900  100 > // MX20 (row1 col10)
        , < &key_physical_attrs 100 100 1000 100 > // MX21 (row1 col9)
        , < &key_physical_attrs 100 100 1100 100 > // MX22 (row1 col8)
        , < &key_physical_attrs 100 100 1200 100 > // MX23 (row1 col7)
        , < &key_physical_attrs 100 100 1300 100 > // MX24 (row1 col6)

        // Третий ряд левая половина
        , < &key_physical_attrs 100 100 0    200 > // MX25 (row2 col0)
        , < &key_physical_attrs 100 100 100  200 > // MX26 (row2 col1)
        , < &key_physical_attrs 100 100 200  200 > // MX27 (row2 col2)
        , < &key_physical_attrs 100 100 300  200 > // MX28 (row2 col3)
        , < &key_physical_attrs 100 100 400  200 > // MX29 (row2 col4)
        , < &key_physical_attrs 100 100 500  200 > // MX30 (row2 col5)

        // Третий ряд правая половина
        , < &key_physical_attrs 100 100 800  200 > // MX31 (row2 col11)
        , < &key_physical_attrs 100 100 900  200 > // MX32 (row2 col10)
        , < &key_physical_attrs 100 100 1000 200 > // MX33 (row2 col9)
        , < &key_physical_attrs 100 100 1100 200 > // MX34 (row2 col8)
        , < &key_physical_attrs 100 100 1200 200 > // MX35 (row2 col7)
        , < &key_physical_attrs 100 100 1300 200 > // MX36 (row2 col6)

        // Четвертый ряд левая половина
        , < &key_physical_attrs 100 100 0    300 > // MX37 (row3 col0)
        , < &key_physical_attrs 100 100 100  300 > // MX38 (row3 col1)
        , < &key_physical_attrs 100 100 200  300 > // MX39 (row3 col2)
        , < &key_physical_attrs 100 100 300  300 > // MX40 (row3 col3)
        , < &key_physical_attrs 100 100 400  300 > // MX41 (row3 col4)
        , < &key_physical_attrs 100 100 500  300 > // MX42 (row3 col5)

        // Четвертый ряд правая половина
        , < &key_physical_attrs 100 100 800  300 > // MX43 (row3 col11)
        , < &key_physical_attrs 100 100 900  300 > // MX44 (row3 col10)
        , < &key_physical_attrs 100 100 1000 300 > // MX45 (row3 col9)
        , < &key_physical_attrs 100 100 1100 300 > // MX46 (row3 col8)
        , < &key_physical_attrs 100 100 1200 300 > // MX47 (row3 col7)
        , < &key_physical_attrs 100 100 1300 300 > // MX48 (row3 col6)

        // Большие пальцы - верхний ряд
        , < &key_physical_attrs 100 100 200  400 > // MX49 (row4 col2)
        , < &key_physical_attrs 100 100 300  400 > // MX50 (row4 col3)
        , < &key_physical_attrs 100 100 1000 400 > // MX51 (row4 col9)
        , < &key_physical_attrs 100 100 1100 400 > // MX52 (row4 col8)

        // Большие пальцы - средний ряд
        , < &key_physical_attrs 100 100 400  500 > // MX53 (row4 col4)
        , < &key_physical_attrs 100 100 500  500 > // MX54 (row4 col5)
        , < &key_physical_attrs 100 100 900  500 > // MX55 (row4 col11)
        , < &key_physical_attrs 100 100 800  500 > // MX56 (row4 col10)

        // Большие пальцы - нижний ряд левый кластер
        , < &key_physical_attrs 100 100 500  600 > // MX57 (row5 col4)
        , < &key_physical_attrs 100 100 600  600 > // MX58 (row5 col5)
        , < &key_physical_attrs 100 100 800  600 > // MX59 (row5 col11)
        , < &key_physical_attrs 100 100 700  600 > // MX60 (row5 col10)

        // Большие пальцы - самый нижний ряд
        , < &key_physical_attrs 100 100 500  700 > // MX61 (row5 col2)
        , < &key_physical_attrs 100 100 600  700 > // MX62 (row5 col3)
        , < &key_physical_attrs 100 100 800  700 > // MX63 (row5 col9)
        , < &key_physical_attrs 100 100 700  700 > // MX64 (row5 col8)
        ;
    };

    kscan0: kscan {
        compatible = "zmk,kscan-gpio-matrix";
        label = "KSCAN";

        diode-direction = "col2row";
        row-gpios
            = <&pro_micro 19 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 18 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 15 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 14 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 16 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&pro_micro 10 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            ;

    };
};
